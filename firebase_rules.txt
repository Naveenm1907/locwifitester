rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // TEMPORARY TESTING RULES - ALLOWS ALL AUTHENTICATED USERS
    // Replace with proper rules after testing
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}

// ============================================================
// PROPER PRODUCTION RULES (USE AFTER TESTING)
// ============================================================
// rules_version = '2';
// service cloud.firestore {
//   match /databases/{database}/documents {
//     
//     // Helper function to check if user is authenticated
//     function isAuthenticated() {
//       return request.auth != null;
//     }
//     
//     // Helper function to check if user is admin (with safe existence check)
//     function isAdmin() {
//       return isAuthenticated() && 
//              exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
//              get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
//     }
//     
//     // Helper function to check if user is the owner
//     function isOwner(userId) {
//       return isAuthenticated() && request.auth.uid == userId;
//     }
//     
//     // Users collection
//     match /users/{userId} {
//       // Anyone authenticated can read users
//       allow read: if isAuthenticated();
//       // Users can create their own profile (important for first-time setup)
//       allow create: if isAuthenticated();
//       // Only the user themselves or admin can update their profile
//       allow update: if isOwner(userId) || isAdmin();
//       // Only admin can delete users
//       allow delete: if isAdmin();
//     }
//     
//     // Rooms collection
//     match /rooms/{roomId} {
//       // Anyone authenticated can read rooms
//       allow read: if isAuthenticated();
//       // Only admins can create/update/delete rooms
//       allow write: if isAdmin();
//     }
//     
//     // WiFi Routers collection
//     match /wifi_routers/{routerId} {
//       // Anyone authenticated can read routers
//       allow read: if isAuthenticated();
//       // Only admins can create/update/delete routers
//       allow write: if isAdmin();
//     }
//     
//     // Attendance collection
//     match /attendance/{attendanceId} {
//       // Anyone authenticated can read (simplified for now)
//       allow read: if isAuthenticated();
//       // Anyone authenticated can create attendance
//       allow create: if isAuthenticated();
//       // Only admins can update/delete attendance records
//       allow update, delete: if isAdmin();
//     }
//   }
// }